(
    resources: [
        (
            id: "fc",
            provider: "cu_micoairh743::MicoAirH743",
        ),
    ],
    tasks: [
        (
            id: "bmi088",
            type: "tasks::Bmi088Source",
            resources: {
                "spi": "fc.bmi088_spi",
                "acc_cs": "fc.bmi088_acc_cs",
                "gyr_cs": "fc.bmi088_gyr_cs",
                "delay": "fc.bmi088_delay",
            },
        ),
        (
            id: "imu_cal",
            type: "tasks::ImuCalibrator",
            config: { "cal_ms": 3000 },
        ),
        (id: "imu_logger", type: "tasks::ImuLogger"),
        (id: "ahrs", type: "cu_ahrs::CuAhrs"),
        (
            id: "attitude",
            type: "tasks::AttitudeController",
            config: {
                "angle_limit_deg": 60.0,
                "acro_rate_dps": 180.0,
                "acro_expo": 0.3,
                "kp": 1.0,
                "ki": 0.0,
                "kd": 0.0,
            },
        ),
        (
            id: "rate",
            type: "tasks::RateController",
            config: {
                "kp": 0.02,
                "ki": 0.0,
                "kd": 0.0001,
                "kp_yaw": 0.05,
                "ki_yaw": 0.0,
                "kd_yaw": 0.0,
                "airmode": true,
                "airmode_start_throttle_percent": 25.0,
            },
        ),
        (
            id: "mixer0",
            type: "tasks::QuadXMixer",
            config: { "motor_index": 0, "props_out": true },
        ),
        (
            id: "mixer1",
            type: "tasks::QuadXMixer",
            config: { "motor_index": 1, "props_out": true },
        ),
        (
            id: "mixer2",
            type: "tasks::QuadXMixer",
            config: { "motor_index": 2, "props_out": true },
        ),
        (
            id: "mixer3",
            type: "tasks::QuadXMixer",
            config: { "motor_index": 3, "props_out": true },
        ),
        (
            id: "mapper",
            type: "tasks::RcMapper",
            config: {
                "arm_channel": 4,
                "arm_min": 1700,
                "arm_max": 1811,
                "mode_channel": 5,
                "mode_low_max": 600,
                "mode_mid_max": 1400,
            },
        ),
        (id: "control_sink", type: "tasks::ControlSink"),
        (
            id: "led_blink",
            type: "tasks::LedBeat",
            resources: { "led": "fc.green_led" },
        ),
        (
            id: "vtx_osd",
            type: "tasks::VtxOsd",
            config: { "cols": 53, "row": 13, "col_center": 26 },
        ),
    ],

    bridges: [
        (  id: "rc",
           type: "cu_crsf::CrsfBridge<cu_micoairh743::Uart6Port, cu_micoairh743::SerialPortError>",
           resources: { "serial": "fc.uart6" },
           channels: [
                Rx ( id: "rc_rx" ),  // receiving RC Channels
                Tx ( id: "lq_tx" ),  // Sending LineQuality back
            ],
        ),
        (
           id: "vtx_msp",
           type: "cu_msp_bridge::CuMspBridge<cu_micoairh743::Uart2Port, cu_micoairh743::SerialPortError>",
           resources: { "serial": "fc.uart2" },
           channels: [
                Tx ( id: "requests" ),
                Rx ( id: "responses" ),
           ],
        ),
        (
           id: "bdshot",
           type: "cu_bdshot::Stm32BdshotBridge",
           channels: [
                Tx ( id: "esc0_tx" ),
                Tx ( id: "esc1_tx" ),
                Tx ( id: "esc2_tx" ),
                Tx ( id: "esc3_tx" ),
                Rx ( id: "esc0_rx" ),
                Rx ( id: "esc1_rx" ),
                Rx ( id: "esc2_rx" ),
                Rx ( id: "esc3_rx" ),
            ],
        ),
    ],

    cnx: [
        (src: "bmi088", dst: "imu_cal", msg: "cu_sensor_payloads::ImuPayload"),
        (src: "mapper", dst: "imu_cal", msg: "crate::messages::ControlInputs"),
        (src: "imu_cal", dst: "imu_logger", msg: "cu_sensor_payloads::ImuPayload"),
        (src: "imu_cal", dst: "ahrs", msg: "cu_sensor_payloads::ImuPayload"),
        (src: "ahrs", dst: "attitude", msg: "cu_ahrs::AhrsPose"),
        (src: "mapper", dst: "attitude", msg: "crate::messages::ControlInputs"),
        (src: "attitude", dst: "rate", msg: "crate::messages::BodyRateSetpoint"),
        (src: "imu_cal", dst: "rate", msg: "cu_sensor_payloads::ImuPayload"),
        (src: "mapper", dst: "rate", msg: "crate::messages::ControlInputs"),
        (src: "rc/rc_rx", dst: "mapper", msg: "cu_crsf::messages::RcChannelsPayload"),
        (src: "mapper", dst: "control_sink", msg: "crate::messages::ControlInputs"),
        (src: "mapper", dst: "led_blink", msg: "crate::messages::ControlInputs"),
        (src: "mapper", dst: "mixer0", msg: "crate::messages::ControlInputs"),
        (src: "mapper", dst: "mixer1", msg: "crate::messages::ControlInputs"),
        (src: "mapper", dst: "mixer2", msg: "crate::messages::ControlInputs"),
        (src: "mapper", dst: "mixer3", msg: "crate::messages::ControlInputs"),
        (src: "mapper", dst: "vtx_osd", msg: "crate::messages::ControlInputs"),
        (src: "rate", dst: "mixer0", msg: "crate::messages::BodyCommand"),
        (src: "rate", dst: "mixer1", msg: "crate::messages::BodyCommand"),
        (src: "rate", dst: "mixer2", msg: "crate::messages::BodyCommand"),
        (src: "rate", dst: "mixer3", msg: "crate::messages::BodyCommand"),
        (src: "mixer0", dst: "bdshot/esc0_tx", msg: "cu_bdshot::EscCommand"),
        (src: "mixer1", dst: "bdshot/esc1_tx", msg: "cu_bdshot::EscCommand"),
        (src: "mixer2", dst: "bdshot/esc2_tx", msg: "cu_bdshot::EscCommand"),
        (src: "mixer3", dst: "bdshot/esc3_tx", msg: "cu_bdshot::EscCommand"),
        (src: "vtx_osd", dst: "vtx_msp/requests", msg: "cu_msp_bridge::MspRequestBatch"),
    ],
    monitor: (
         type: "cu_logmon::CuLogMon",
    ),
    logging: (
        slab_size_mib: 16,
        section_size_mib: 4,
        enable_task_logging: false,
    ),
)
